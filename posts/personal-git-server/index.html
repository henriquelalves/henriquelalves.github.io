<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
<title>a lightweight personal self-hosted git server | henriquelalves</title>

  <link rel="shortcut icon" type="image/png" href="&#x2F;images&#x2F;favicon.png">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link id="stylesheet" rel="stylesheet" type="text/css" href="/main.css">
  <script defer src="https://umami.henriquelalves.com/script.js" data-website-id="04d239e9-77fc-4a81-94ad-938cc3c85948"></script>
</head>

<div class="header">
  <div class="site_title">
    <p><a href="/"><img class="icon" src="https:&#x2F;&#x2F;henriquelalves.com&#x2F;images&#x2F;logo.png" alt="henriquelalves"
                                                                                 width="70" height=auto ></a></p>
    <p><a href="/">&nbsp;henriquelalves</a></p>
  </div>
  <div class="menu">
    <a href="/posts">posts</a>
    &nbsp;&nbsp;&nbsp;<a href="/about">about</a>
		&nbsp;&nbsp;&nbsp;<a href="/readinglist">reading list</a>
		&nbsp;&nbsp;&nbsp;<a href="/projects">projects</a>
  </div>
</div>

<body>
  <section class="section">
    <div class="container">
      
<p>
  <div class="title_postpage">a lightweight personal self-hosted git server</div>
</p>
<p>
  <div class="date_postpage">2024-11-30</div>
  <div class="taxonomies_postpage">
  
  
      
      &emsp;<a href="https://henriquelalves.com/tags/self-hosting/">#self-hosting</a>
      
      &emsp;<a href="https://henriquelalves.com/tags/git/">#git</a>
      
  
  </div>
</p>

<p>
  <p>For some time I've been looking for a good solution to self-host my own git private server, and start migrating from GitHub. My requisites were:</p>
<ul>
<li>Lightweight.</li>
<li>A frontend for public repositories.</li>
<li>An easy API to manage my repositories.</li>
</ul>
<p>Which, to be honest, are not many requites, but even then it did made me scratch my head a lot on the best approach. After playing with some solutions (from vanilla git running on a remote machine and managing it with SSH, to different flavours of Gitea and GitLab), the one I feel most confortable is using just two very simple tools: <strong>cgit</strong> and <strong>Soft Serve</strong>. You can check the (public repositories) end result here: <a href="https://git.henriquelalves.com/">https://git.henriquelalves.com/</a>. I'm still in the process of migrating some of my repositories from GitHub, but I'm confident I'll be using this solution for years to come.</p>
<h3 id="what-cgit-does">What cgit does?</h3>
<p><a href="https://git.zx2c4.com/cgit/about/">cgit</a> is a web frontend for a system folder that contains git repositories. That's it.</p>
<p>It has <strong>no git functionality</strong>, it just controls web requests and spit out a tidy web page with your repository descriptions, and may also be used for HTTP git cloning. Super lightweight, easy to setup and configure, and the defaults are enough for 99% of cases.</p>
<p>It also has NO functionality for Issues/Pull Requests, which for me is a plus. I don't want to receive issues or pull requests, I'm just providing the source code of my software AS IS. If I ever consider receiving Issues or Pull Requests, I'll setup an email account to receive patches.</p>
<h3 id="what-soft-serve-does">What Soft Serve does?</h3>
<p><a href="https://github.com/charmbracelet/soft-serve">Soft Serve</a> is a <code>self-hostable Git server for the command line</code>, per their GitHub page.</p>
<p>What it really does is running a lightweight server on your machine that you can login via SSH, and compared to using vanilla git on a remote machine, it's basically simplifying the process from &quot;Login via SSH to my remote machine and manually setup and configure git bare-repositories&quot; to &quot;call <code>ssh soft</code> on my local machine and manage everything on a pretty TUI&quot;.</p>
<p>It also provides some cool tools to manage private repository access for different users (different SSH keys). I never used this feature, but it's a nice-to-have that gives me some peace of mind.</p>
<h3 id="why-both-tools">Why both tools?</h3>
<p><strong>cgit</strong> has no git functionality, but it's a good lightweight git repositories frontend.</p>
<p><strong>Soft Serve</strong> is a great (and also lightweight) git server, but it's a tool for the <strong>developer</strong>, and provides no public interface for the repositories.</p>
<h3 id="how-to-manage-both-tools">How to manage both tools?</h3>
<p>The way I use the two tools, I have:</p>
<ul>
<li>A root repositories folder on my system (e.g. <code>home/git/repos/</code>)</li>
<li>Every repository is managed by <strong>Soft Serve</strong>. Repositories I want to be public are named <code>public/[...].git</code>, and private repositories are <code>private/[...].git</code>. That makes all repositories fall into either <code>home/git/repos/public/</code> or <code>home/git/repos/private/</code> subfolders.</li>
<li><strong>cgit</strong> scan path is <code>home/git/repos/public/</code>. It has no access to the private repos, and nor does it care.</li>
</ul>
<p>Done and done.</p>
<p><strong>Soft Serve</strong> has it's own server process that you run with a <code>soft serve</code> command, while <strong>cgit</strong> runs as a <a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> program. Since Soft Serve uses exclusively SSH (and you'd be using the terminal to do so), you don't need to worry about reverse-proxy and whatnot - you can just run Soft Serve on a VPS with the ports it needs open, and configure your client <code>.ssh/known_hosts</code> (so you don't need to remember the IP address all the time). Soft Serve README does a really good job explaining the whole process and you shouldn't have many difficulties setting it up on a VPS. The one thing I did extra was to create a <code>systemd</code> service for it (so if its process ever crashes, it will restart).</p>
<p><strong>cgit</strong>, on the other hand, needs a reverse-proxy. I used two tools:</p>
<ul>
<li><a href="https://www.lighttpd.net/">Lighttpd</a> running on a local (not public) port, redirecting to the cgit cgi.</li>
<li><a href="https://caddyserver.com/">Caddy</a> reverse-proxying my domain to the local Lighttpd port.</li>
</ul>
<p>There are certainly simpler solutions, but Caddy is in my comfort-zone when I don't want to think about SSL certificates. Caddy itself has no CGI support though, hence the &quot;Caddy -&gt; Lighttpd&quot; flow.</p>
<p>Last but not least, it still is a public server, so I recommend installing and configuring <code>ufw</code> to block all ports (but the ones you are actually using for <strong>Soft Serve</strong> and serving HTTPS requests via <strong>Caddy</strong>) and installing <code>fail2ban</code> on your machine.</p>

  <hr class="hr_bottom"/>
</p>




    </div>
  </section>
</body>

<div class="footer">
	<div class="left">
		<a href="https://mastodon.gamedev.place/@henriquelalves">
				<img src="/socials/mastodon.png" alt="Mastodon icon">
		</a>
		&nbsp;
		<a href="https://github.com/henriquelalves">
				<img src="/socials/github.png" alt="Github icon">
		</a>
		&nbsp;
		<a href="https://www.linkedin.com/in/henriquelalves/">
		  <img src="/socials/linkedin.png" alt="Linkedin icon">
		</a>
		&nbsp;
		<a href="https://perons.itch.io/">
			<img src="/socials/itchio.png" alt="ItchIo icon">
		</a>		
	</div>
	<div class="right">
		<a href="/">henriquelalves</a>&emsp;&copy; henrique l alves<br>
		powered by <a href="https://www.getzola.org/">Zola</a>, based on <a href="https://github.com/kyoheiu/emily_zola_theme">emily</a>.
	</div>
</div>

</html>
